{% from "govuk/components/pagination/macro.njk" import govukPagination %}

{% macro renderPagination(currentPage, totalPages, baseUrl, queryParams) %}
    {% if totalPages > 1 %}
        {% set paginationItems = [] %}

        {# Always include the first page #}
        {% set _ = paginationItems.push({
            "number": 1,
            "href": buildPageUrl(baseUrl, queryParams, 1),
            "current": currentPage == 1
        }) %}

        {# Add elipses if there's a gap between first page and current range #}
        {% if currentPage > 3 %}
            {% set _ = paginationItems.push({ "ellipsis": true }) %}
        {% endif %}

        {# Generate up to 3 surrounding pages dynamically #}
        {% for i in range(currentPage - 1, currentPage + 2) %}
            {% if i > 1 and i < totalPages %}
                {% set _ = paginationItems.push({
                    "number": i,
                    "href": buildPageUrl(baseUrl, queryParams, i),
                    "current": i == currentPage
                }) %}
            {% endif %}
        {% endfor %}

        {# Add elipses if there's a gap before the last page #}
        {% if currentPage < totalPages - 2 %}
            {% set _ = paginationItems.push({ "ellipsis": true }) %}
        {% endif %}

        {# Always include the last page #}
        {% if totalPages > 1 and totalPages != 1 %}
            {% set _ = paginationItems.push({
                "number": totalPages,
                "href": buildPageUrl(baseUrl, queryParams, totalPages),
                "current": currentPage == totalPages
            }) %}
        {% endif %}

        {{ govukPagination({
            "previous": { "href": buildPageUrl(baseUrl, queryParams, (currentPage - 1)) } if currentPage > 1 else {},
            "next": { "href": buildPageUrl(baseUrl, queryParams, (currentPage + 1)) } if currentPage < totalPages else {},
            "items": paginationItems
        }) }}
    {% endif %}
{% endmacro %}
