{% extends "views/layouts/main.njk" %}

{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/tag/macro.njk" import govukTag %}
{% from "govuk/components/tabs/macro.njk" import govukTabs %}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}

{% block pageContent %}
    {% if repUpdated %}
        {{ govukNotificationBanner({
            text: "Representation has been " + repUpdated,
            type: "success"
        }) }}
    {% endif %}

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">
            <p class="govuk-body">
                <a href="" class="govuk-link govuk-link--no-visited-state">Add a representation</a>
            </p>
        </div>
    </div>

    {% set awaitingReviewTable %}
        {{ repsTable(reps.awaitingReview, true) }}
    {% endset -%}

    {% set acceptedTable %}
        {{ repsTable(reps.accepted, false) }}
    {% endset -%}

    {% set rejectedTable %}
        {{ repsTable(reps.rejected, false) }}
    {% endset -%}

    {{ govukTabs({
        items: [
            {
                label: "Awaiting Review",
                id: "awaiting-review",
                panel: {
                html: awaitingReviewTable
            }
            },
            {
                label: "Accepted",
                id: "accepted",
                panel: {
                html: acceptedTable
            }
            },
            {
                label: "Rejected",
                id: "rejected",
                panel: {
                html: rejectedTable
            }
            }
        ]
    }) }}

{% endblock %}

{% macro repsTable(representations, review) %}
    {% set repsRows = [] %}
    {% for rep in representations %}
        {% set row = [
            {
                text: rep.reference
            },
            {
                text: rep.SubmittedByContact.fullName
            },
            {
                text: rep.submittedDate
            }
        ] %}

        {% if review %}
            {% set row = (row.push({
                html: '<a href="'+ baseUrl + '/' + rep.reference + '" class="govuk-link">Review</a>'
            }), row) %}
        {% else %}
            {% set row = (row.push({
                html: '<a href="'+ baseUrl + '/' + rep.reference + '" class="govuk-link">View</a>'
            }), row) %}
        {% endif %}
        {% set repsRows = (repsRows.push(row), repsRows) %}
    {% endfor %}

    {% set headers = [
        {
            text: "Reference"
        },
        {
            text: "Interested party"
        },
        {
            text: "Submitted"
        },
        {
            text: "Action"
        }
    ] %}

    {{ govukTable({
        head: headers,
        rows: repsRows
    }) }}
{% endmacro %}